/**
 * ========================================================================
 * BU Section Editing plugin - Hierarchiacl Permissions Editor
 * ========================================================================
 *//*jslint browser: true, todo: true *//*global bu: true, jQuery: false, console: false, window: false, document: false */(function(e){if(typeof bu=="undefined"||typeof bu.plugins.navigation=="undefined"||typeof bu.plugins.navigation.tree=="undefined")return;var t=bu.plugins.navigation;t.trees.buse_perm_editor=function(n,r){r=r||{};var i=t.trees.base(n,r),s=i.data,o=e.extend(i.config,n||{}),u=i.$el,a=e.inArray("crrm",s.treeConfig.plugins);if(a>-1){s.treeConfig.plugins.splice(a,1);typeof s.treeConfig["crrm"]!="undefined"&&delete s.treeConfig.crrm}var f=e.inArray("dnd",s.treeConfig.plugins);if(f>-1){s.treeConfig.plugins.splice(f,1);typeof s.treeConfig["dnd"]!="undefined"&&delete s.treeConfig.dnd}s.treeConfig.types={types:{"default":{},denied:{},"denied-desc-allowed":{},"denied-desc-unknown":{},allowed:{},"allowed-desc-denied":{},"allowed-desc-unknown":{}}};s.treeConfig.ui={select_limit:1};s.treeConfig.json_data.ajax={url:o.rpcUrl,type:"GET",cache:!1,data:function(e){return{group_id:o.groupID,node_prefix:o.nodePrefix,post_type:o.postType,query:{child_of:e.attr?r.stripNodePrefix(e.attr("id")):0}}},success:function(e){return e.posts},error:function(e){}};s.treeConfig.json_data.progressive_render=!1;var l=function(t){t=!t||t==-1?u.find("> ul > li"):e.jstree._reference(u)._get_node(t);var n,r,i,s;t.each(function(){n=e(this);n.find("li").andSelf().each(function(){i=e(this).data("editable")?"denied":"allowed";s=i=="allowed"?"Allow":"Deny";r=e('<button class="edit-perms '+i+'"></button>').text(s);e(this).children("a").not(":has(.edit-perms)").append(r)})})};u.bind("open_node.jstree create_node.jstree clean_node.jstree refresh.jstree",function(e,t){l(t.rslt.obj)});u.bind("loaded.jstree",function(e){l()});u.addClass("buse-perm-editor");return i}})(jQuery);